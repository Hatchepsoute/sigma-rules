# TheHive Playbook (SOAR-ready) — CVE-2025-62549 (Windows RRAS RCE)
version: "1.0"
id: "playbook-cve-2025-62549-fr"
name: "CVE-2025-62549 — RRAS Remote Code Execution"
description: >
  Playbook SOC pour qualifier et contenir une exploitation potentielle de RRAS (RemoteAccess)
  pouvant mener à une exécution de code à distance via le réseau.
severity_default: "high"
labels:
  - "cve-2025-62549"
  - "rras"
  - "remoteaccess"
  - "rce"
  - "cwe-822"
inputs:
  - name: "hostname"
    type: "string"
    required: true
  - name: "parent_commandline"
    type: "string"
    required: false
  - name: "child_process"
    type: "string"
    required: false
  - name: "commandline"
    type: "string"
    required: false
  - name: "dest_ip"
    type: "string"
    required: false
  - name: "dest_domain"
    type: "string"
    required: false

workflow:
  - step: "Triage_L1"
    title: "Triage L1 — valider RRAS svchost → shell/LOLBIN"
    actions:
      - type: "check"
        name: "Valider rôle RRAS"
        details: "Confirmer RemoteAccess actif et exposition (VPN/accès distant)."
      - type: "check"
        name: "Valider parent RemoteAccess"
        details: "Confirmer ParentCommandLine: svchost.exe ... -s RemoteAccess."
      - type: "check"
        name: "Collecte preuves process"
        details: "Capturer process tree + CommandLine + hash des binaires enfants."
      - type: "decision"
        name: "Qualification initiale"
        outcomes:
          - when: "strict_hit"
            result: "Investigation_L2"
          - when: "broad_hit"
            result: "Investigation_L2"
          - when: "documented_change"
            result: "Close_FP"

  - step: "Investigation_L2"
    title: "Investigation L2 — réseau, persistance, impact"
    actions:
      - type: "hunt"
        name: "Corréler réseau sortant"
        details: "Identifier egress post-exécution vers IP/domaine non fiable (proxy/firewall/sysmon)."
      - type: "hunt"
        name: "Chercher persistance"
        details: "Tâches planifiées, nouveaux services, Run keys, nouveaux binaires."
      - type: "hunt"
        name: "Chercher mouvement latéral"
        details: "RDP/SMB/WinRM, exécutions distantes, comptes créés."
      - type: "decision"
        name: "Décision L2"
        outcomes:
          - when: "confirmed_incident"
            result: "Containment_L3"
          - when: "probable_incident"
            result: "Containment_Conditional"
          - when: "false_positive"
            result: "Close_FP"

  - step: "Containment_L3"
    title: "Containment immédiat"
    actions:
      - type: "contain"
        name: "Isoler l’hôte"
        details: "Isoler le serveur RRAS/VPN via EDR ou segmentation."
      - type: "contain"
        name: "Réduire exposition"
        details: "Limiter accès RRAS (ACL, allowlist IP, firewall)."
      - type: "collect"
        name: "Collecte & forensic"
        details: "Collecter logs RRAS, artefacts, timeline, egress, dumps si possible."
      - type: "response"
        name: "Patch & hardening"
        details: "Appliquer correctifs Microsoft et revoir configuration RRAS."
      - type: "escalate"
        name: "Escalade IR"
        details: "Notifier IR/CSIRT et ouvrir incident majeur si Internet-facing."

  - step: "Containment_Conditional"
    title: "Containment conditionnel"
    actions:
      - type: "contain"
        name: "Restriction réseau"
        details: "Réduire temporairement l’exposition RRAS en attendant validation."
      - type: "collect"
        name: "Collecte minimale"
        details: "Process tree, CommandLine, egress, hashes."
      - type: "monitor"
        name: "Surveillance"
        details: "Hunting 24-48h sur RemoteAccess → shell/LOLBIN + egress."

  - step: "Close_FP"
    title: "Clôture Faux Positif"
    actions:
      - type: "document"
        name: "Justification FP"
        details: "Ticket IT + preuve d’usage admin légitime."
      - type: "tune"
        name: "Tuning"
        details: "Allowlist scripts/outils/domaine approuvés si répétitif."
      - type: "close"
        name: "Clôturer"
        details: "Clôture et documentation."
decision_logic:
  strict_hit: "svchost RemoteAccess → shell + CLI suspecte (URL/-enc/IEX/etc.)"
  broad_hit: "svchost RemoteAccess → LOLBIN"
  documented_change: "ticket IT + preuve"
  confirmed_incident: "strict_hit + egress suspect OU persistance + pas de ticket"
  probable_incident: "broad_hit + pas de ticket"
  false_positive: "preuve forte d’usage légitime"
outputs:
  - "classification"
  - "ioc_list"
  - "evidence_bundle"
  - "recommended_actions"
