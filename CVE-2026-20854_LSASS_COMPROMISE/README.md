# üõ°Ô∏è Sigma Rules for CVE-2026-20854 Detection

## Overview
This repository contains **3 Sigma detection rules** designed to identify exploitation and post-exploitation activity related to **CVE-2026-20854**, a Use-After-Free vulnerability in Windows LSASS (Local Security Authority Subsystem Service) allowing remote code execution.

## The Rules

| Rule File | Level | Purpose |
|-----------|-------|---------|
| `win_process_access_lsass_memory_access_cve_2026_20854_strict.yml` | **High** | Detects suspicious memory access to LSASS (credential dumping patterns) |
| `win_process_creation_lsass_child_process_cv_2026_20854_critical.yml` | **Critical** | Detects LSASS spawning child processes (active exploitation indicator) |
| `win_process_creation_lsass_post_exploit_cve_2026_20854_broad.yml` | **Low** | Broad hunting rule for High/System integrity processes (post-exploitation activity) |

## Detection Strategy
```
CVE-2026-20854 Exploitation Chain
‚îú‚îÄ‚îÄ Phase 1: RCE in LSASS
‚îÇ ‚îî‚îÄ‚îÄ üî¥ CRITICAL rule: LSASS child process
‚îÇ
‚îú‚îÄ‚îÄ Phase 2: Credential Dumping
‚îÇ ‚îî‚îÄ‚îÄ üü† HIGH rule: LSASS memory access
‚îÇ
‚îî‚îÄ‚îÄ Phase 3: Lateral Movement / Persistence
‚îî‚îÄ‚îÄ üü° HUNTING rule: System integrity processes
```


## Deployment Recommendations

### üö® **For Production Alerting**
Enable these rules immediately:
- `*_strict.yml`
- `*_critical.yml`

### üîç **For Threat Hunting**
Use this rule for weekly proactive searches:
- `*_broad.yml` **(DO NOT alert on this rule)**

## Rule Details

### 1. STRICT - LSASS Memory Access
**File:** `[win_process_access_lsass_memory_access_cve_2026_20854_strict.yml](./rules/win_process_access_lsass_memory_access_cve_2026_20854_strict.yml)`  
**Level:** High  
**Log Source:** Windows Process Access  
**Description:** Detects processes accessing LSASS memory with suspicious access masks (`0x10`, `0x30`, `0x1410`) commonly used for credential dumping.

### 2. CRITICAL - LSASS Child Process
**File:** `[win_process_creation_lsass_child_process_cv_2026_20854_critical.yml](./rules/win_process_creation_lsass_child_process_cv_2026_20854_critical.yml)`  
**Level:** Critical  
**Log Source:** Windows Process Creation  
**Description:** Detects LSASS.exe creating child processes - a strong indicator of code execution within LSASS (active exploitation).

### 3. BROAD - System Integrity Hunting
**File:** `[win_process_creation_lsass_post_exploit_cve_2026_20854_broad.yml](./rules/win_process_creation_lsass_post_exploit_cve_2026_20854_broad.yml)`  
**Level:** Low  
**Log Source:** Windows Process Creation  
**Description:** Broad hunting rule for High/System integrity processes. Identifies potential post-exploitation activity.

## Tuning Guidelines

### Strict Rule (Memory Access)
- Monitor the `CallTrace` field to identify legitimate access patterns
- Add your EDR/AV solutions to the `filter_legitimate` section with proper paths
- Verify `SignatureStatus` and `SignatureProductName` for Microsoft-signed tools
- Common legitimate tools: `taskmgr.exe`, `perfmon.exe`, `mmc.exe`

### Critical Rule (LSASS Child Process)
- **Almost zero false positives** - investigate immediately
- Only known exception: `WerFault.exe` during system crashes (already filtered)
- Document any legitimate Microsoft-signed child processes (extremely rare)
- Create an incident response playbook specifically for this alert

### Broad Rule (Hunting)
- **DO NOT enable alerting** - use for hunting only
- Customize filters based on your environment (RMM tools, management software)
- Review results weekly and tune exclusions
- Look for anomalies like:
  - PowerShell/cmd.exe from unexpected parents
  - Script interpreters with network connections
  - Processes running from temporary locations

## False Positives Management

| Rule | False Positive Rate | Common Sources | Mitigation |
|------|--------------------|----------------|------------|
| Strict | Low | Security scans, EDR/AV | Add to allowlist with signature verification |
| Critical | Near Zero | System crash (WerFault) | Already filtered |
| Broad | Very High | IT management tools, updates | Environment-specific tuning required |

## Installation

### Prerequisites
- Sigma-supported SIEM (Splunk, Elastic, QRadar, Sentinel, etc.)
- Windows process creation and process access logging enabled
- PowerShell script block logging (recommended for deeper analysis)
