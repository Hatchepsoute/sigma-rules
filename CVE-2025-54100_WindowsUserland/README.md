<!-- Badges (edit the links if you rename the repo/branch) -->
![Sigma](https://img.shields.io/badge/Sigma-rules-blue)
![SOC](https://img.shields.io/badge/SOC-ready-success)
![SOAR](https://img.shields.io/badge/SOAR-playbooks-important)
![MITRE](https://img.shields.io/badge/MITRE-ATT%26CK-lightgrey)
![License](https://img.shields.io/badge/License-MIT-informational)
# Windows Userland RCE – LOLBins & PowerShell IWR (Sigma Rules)

## Status
- **Experimental**
- Designed for SOC detection, triage, and incident response

---

## Overview

This directory contains **two correlated Sigma rules** intended to detect **userland Remote Code Execution (RCE) post-exploitation behaviors on Windows systems**.

These rules are **behavior-based** and apply to multiple exploitation scenarios, including but not limited to **CVE-2025-54100** and similar client-side vulnerabilities.

They follow the **official sigma-rules detection philosophy**:
- One **BROAD** rule for wide behavioral coverage
- One **STRICT** rule for high-confidence malicious activity

Both rules are intended to be **deployed together**.

---

## Threat Context

After a userland RCE (e.g., browser, Office, document, or script exploitation), attackers frequently:

- Abuse **Windows LOLBins** (PowerShell, cmd, mshta, rundll32, etc.)
- Download payloads from remote servers
- Execute secondary stages or loaders
- Transition toward persistence or ransomware deployment

Sigma rules do not detect the vulnerability itself, but they reliably detect **dangerous post-execution behaviors**.

---

## Rule 1 – BROAD

### Name
**Suspicious LOLBin Execution with Risky Command Line (BROAD)**

### Purpose
Detect suspicious execution of common Windows LOLBins combined with **risky command-line patterns** often seen after userland RCE.

### Detection Logic
- **Process image**: Common LOLBins
- **Command line**: Network access, encoded commands, or execution patterns
- **No parent process constraint**

### SOC Interpretation
- Suspicious activity
- Possible exploitation or staged execution
- Requires analyst validation

### Recommended Usage
- SOC L1 / L2 triage
- Threat hunting
- Baseline behavioral detection

---

## Rule 2 – STRICT

### Name
**PowerShell Invoke-WebRequest Followed by Child Execution (STRICT)**

### Purpose
Detect **high-confidence malicious download-and-execute patterns**.

### Detection Logic
- **Parent process**: PowerShell (`powershell.exe` / `pwsh.exe`)
- **Parent command line**: `Invoke-WebRequest` / `iwr` / `curl` / `wget`
- **Child process**: Execution-capable LOLBins

### SOC Interpretation
- **High-confidence malicious activity**
- Clear download → execute behavior
- Strong indicator of post-exploitation

### Recommended Usage
- SOC L2 / L3 escalation
- Incident declaration
- SOAR / automated containment

---

## Correlation Strategy (Required)

These rules are designed to be **correlated**.

### Recommended Detection Flow

1. **BROAD rule triggers**
   - Suspicious LOLBin execution detected
   - Analyst context established

2. **STRICT rule triggers**
   - Download-and-execute behavior confirmed
   - Incident escalated

This correlation approach:
- Reduces false positives
- Preserves early visibility

---

## SOC Comparison Table

| Criteria | BROAD | STRICT |
|------|------|------|
| Detection scope | Broad | Narrow |
| False positives | Possible | Very rare |
| Confidence level | Medium | High |
| Parent-child analysis | ❌ | ✅ |
| Download detection | ✅ | ✅ |
| Explicit execution | ❌ | ✅ |
| SOC usage | L1 / L2 | L2 / L3 |
| Incident-ready | ❌ | ✅ |

---

## Best Practice

> Always deploy **both rules together**.
>
> - BROAD provides **wide behavioral coverage**
> - STRICT confirms **malicious intent**
>
> This pairing delivers robust detection of **Windows userland RCE post-exploitation chains**.
