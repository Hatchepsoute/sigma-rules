# TheHive SOAR Playbook (YAML) â€” CVE-2025-54100
# Template: triage + containment for suspicious post-RCE patterns (PowerShell IWR + child execution)

playbook:
  name: "CVE-2025-54100 | Windows Userland RCE | Triage & Containment"
  version: "1.0"
  owner: "SOC"
  severity: "High"
  tags:
    - "cve.2025-54100"
    - "attack.t1059"
    - "attack.t1105"

workflow:
  - step: "Validate Alert"
    actions:
      - type: "collect"
        name: "Fetch process tree"
        details: "Retrieve parent/child process and full command lines from EDR/SIEM."
      - type: "collect"
        name: "Check network egress"
        details: "Review proxy/EDR outbound connections around alert time."
    decision:
      condition: "parent_is_powershell == true and parent_contains_iwr == true"
      on_true: "Scope Impact"
      on_false: "False Positive Handling"

  - step: "Scope Impact"
    actions:
      - type: "collect"
        name: "Search for persistence"
        details: "Scheduled tasks, services, Run keys created after the event."
      - type: "collect"
        name: "Hunt for similar activity"
        details: "Search for the BROAD rule across last 7 days on same host/user."
    decision:
      condition: "child_is_lolbin == true or suspicious_cli == true or suspicious_egress == true"
      on_true: "Containment"
      on_false: "Enhanced Monitoring"

  - step: "Containment"
    actions:
      - type: "contain"
        name: "Isolate host"
        details: "EDR isolate endpoint if available; otherwise network quarantine."
      - type: "contain"
        name: "Block indicators"
        details: "Block suspicious URLs/domains/IPs observed in command line or egress."
      - type: "response"
        name: "Collect forensic package"
        details: "Collect memory/process evidence, autoruns, and key logs."
    next: "Eradication & Recovery"

  - step: "Enhanced Monitoring"
    actions:
      - type: "monitor"
        name: "Increase telemetry"
        details: "Increase PowerShell logging & process creation telemetry for 24-48h."
      - type: "monitor"
        name: "Add temporary watchlist"
        details: "Watch for new child spawns from PowerShell with web retrieval."
    next: "Close or Escalate"

  - step: "False Positive Handling"
    actions:
      - type: "verify"
        name: "Validate IT change"
        details: "Confirm approved change, signed scripts, known tool chain."
      - type: "tuning"
        name: "Tune detection"
        details: "Allowlist known paths/signers/accounts if repetitive and validated."
    next: "Close"

  - step: "Eradication & Recovery"
    actions:
      - type: "eradicate"
        name: "Remove persistence/payloads"
        details: "Remove dropped files, tasks, services, and revoke creds if needed."
      - type: "recover"
        name: "Patch & harden"
        details: "Apply patches and harden scripting where feasible."
    next: "Post-Incident"

  - step: "Post-Incident"
    actions:
      - type: "lessons_learned"
        name: "Report & improve"
        details: "Update detections and improve SOAR automation for next cycle."
    next: "Close"
