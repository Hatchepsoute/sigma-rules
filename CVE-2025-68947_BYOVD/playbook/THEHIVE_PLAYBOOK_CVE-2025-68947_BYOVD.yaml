version: 1
name: "CVE-2025-68947 - BYOVD (NSecKrnl) - Pre-Ransomware Response"
description: >
  Incident response playbook aligned with Sigma detections for CVE-2025-68947 BYOVD abuse (Black Basta / Cardinal scenario). Designed for early warning (BROAD), high confidence (STRICT), and correlation with a separate generic Kill-EDR rule at SIEM/SOAR level.
severity: 3   # 1=Low,2=Medium,3=High,4=Critical (adjust to your TheHive mapping)
tlp: 2        # 0=WHITE,1=GREEN,2=AMBER,3=RED
pap: 2        # 0=WHITE,1=GREEN,2=AMBER,3=RED
tags:
  - "cve-2025-68947"
  - "byovd"
  - "defense-evasion"
  - "pre-ransomware"
  - "sigma"
  - "attack-t1068"
  - "attack-t1543.003"
  - "attack-t1562.001"

# Optional: template-level custom fields (adapt names to your instance)
customFields:
  cve:
    string: "CVE-2025-68947"
  technique:
    string: "BYOVD (Bring Your Own Vulnerable Driver)"
  suspected_driver:
    string: "NSecKrnl.sys / 402.sys"
  ransomware_family:
    string: "Black Basta (Cardinal) - suspected"
  detection_sources:
    string: "Sigma BROAD (driver_load), Sigma STRICT (process_creation), Generic Kill-EDR (separate)"

tasks:

  - title: "Triage - Classify Alert (BROAD vs STRICT vs Correlated)"
    description: >
      Identify which signals triggered:
      - BROAD: suspicious driver load (NSecKrnl.sys / 402.sys) from non-standard path
      - STRICT: kernel driver service install/config via sc.exe/PowerShell (NSecKrnl)
      - Generic Kill-EDR: security/EDR process termination or service stop (separate rule)
      Set incident severity accordingly and decide containment urgency.
    status: "Waiting"
    flag: false
    order: 1

  - title: "Triage - Collect Key Context (Host/User/Time/Paths)"
    description: >
      Collect:
      - Hostname, domain, user, logon type if available
      - Timestamp(s) of detections
      - Driver name and full path (NSecKrnl.sys / 402.sys)
      - Suspect process / parent process / command line (if available)
      - Any service name & binPath (NSecKrnl) if STRICT triggered
    status: "Waiting"
    flag: false
    order: 2

  - title: "Containment - Isolate Host (STRICT or Correlated)"
    description: >
      If STRICT triggered OR correlation indicates pre-ransomware:
      - Isolate endpoint from network (EDR isolation / NAC / switch port)
      - Block remote admin access temporarily if needed
      - Prevent further driver/service installation
      Document who performed isolation and when.
    status: "Waiting"
    flag: true
    order: 3

  - title: "Investigation - Verify Driver & Service Artifacts"
    description: >
      Validate:
      - Driver file on disk (path, size, signature/publisher if available)
      - Presence of renamed driver (402.sys) or alternate filenames
      - Service creation/config: 'NSecKrnl' (binPath points to NSecKrnl.sys/402.sys)
      - Any persistence indicators related to service settings
    status: "Waiting"
    flag: false
    order: 4

  - title: "Investigation - Hunt Defense Evasion (Kill EDR / Service Stop)"
    description: >
      Check whether security tooling was tampered with:
      - Process termination events targeting AV/EDR processes
      - Service stop events for security agents
      - Gaps in telemetry (agent crashes, missing logs)
      Correlate with BROAD/STRICT timing (Â±10 minutes).
    status: "Waiting"
    flag: true
    order: 5

  - title: "Investigation - Lateral Movement & Persistence Hunt"
    description: >
      Hunt for:
      - Remote execution (PsExec/WMI/WinRM/SMB)
      - New local admins, scheduled tasks, suspicious services
      - Unusual network connections from affected host
      - Signs of staged payloads (loader / RAT indicators)
    status: "Waiting"
    flag: false
    order: 6

  - title: "Eradication - Remove Malicious Driver & Service"
    description: >
      If confirmed malicious:
      - Remove kernel service (NSecKrnl) safely
      - Remove driver file (NSecKrnl.sys / 402.sys) after containment
      - Restore security tooling and validate health
      Preserve evidence before deletion when possible.
    status: "Waiting"
    flag: true
    order: 7

  - title: "Recovery - Credentials, Patching & Hardening"
    description: >
      - Rotate credentials used on the host (local admin / service accounts)
      - Ensure security tools are running and updated
      - Apply mitigations against BYOVD:
        - driver block rules (WDAC / HVCI where applicable)
        - block vulnerable driver loading where feasible
      - Monitor for recurrence
    status: "Waiting"
    flag: false
    order: 8

  - title: "Closure - Lessons Learned & Tuning"
    description: >
      - Tune BROAD false positives (legit paths, admin tools, approved drivers)
      - Validate STRICT coverage across fleets
      - Document correlation logic in SIEM/SOAR
      - Share anonymized learnings with the community if possible
    status: "Waiting"
    flag: false
    order: 9

observables:
  # Add observables from alerts / SIEM enrichment (examples)
  - dataType: "other"
    data: "NSecKrnl.sys"
    message: "Suspected vulnerable driver filename"
    tags: ["byovd", "driver"]
  - dataType: "other"
    data: "402.sys"
    message: "Potential renamed vulnerable driver filename"
    tags: ["byovd", "driver"]
  - dataType: "other"
    data: "NSecKrnl"
    message: "Kernel driver service name used by PoC/campaign"
    tags: ["service", "driver"]

