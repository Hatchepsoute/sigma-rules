version: 1
name: "Chaînes d’exploitation Office - Global (SOAR-ready)"
description: "Workflow triage et réponse pour activité LOLBIN déclenchée par Office (couverture globale chaîne RCE Office)."
severity: "HIGH"
tags:
  - "attack.t1204.002"
  - "attack.t1059.001"
  - "attack.t1105"
  - "attack.t1218"
inputs:
  - { name: alert_id, type: string }
  - { name: host, type: string }
  - { name: user, type: string }
  - { name: parent_process, type: string }
  - { name: child_process, type: string }
  - { name: command_line, type: string }
  - { name: dst_ip, type: string }
  - { name: dst_domain, type: string }
  - { name: url, type: string }

workflow:
  - step: "Analyste N1 - Valider le contexte Office"
    actions:
      - "Confirmer que le parent est Office (WINWORD/EXCEL/POWERPNT/OUTLOOK/MSACCESS)."
      - "Capturer l’arbre de processus complet et les timestamps."
  - step: "Analyste N1 - Analyser le processus enfant et la ligne de commande"
    actions:
      - "Vérifier que l’enfant est un LOLBIN/moteur de script."
      - "Chercher patterns URL/download/obfuscation (-enc, IEX, base64)."
  - step: "Analyste N1 - Corrélation réseau"
    actions:
      - "Vérifier DNS/proxy/pare-feu : trafic sortant vers hôte non fiable (first-seen, réputation, géo inhabituelle)."
  - step: "Analyste N2 - Vérif persistance"
    actions:
      - "Hunting persistance créée peu après (task/service/Run keys/Startup)."
  - step: "Analyste N2 - Décision"
    actions:
      - "Appliquer table décisionnelle : CONFIRMED / PROBABLE / FP."
  - step: "Réponse - Confinement"
    when: "decision in ['CONFIRMED','PROBABLE']"
    actions:
      - "Isoler l’hôte via EDR."
      - "Terminer les processus suspects."
      - "Bloquer IOC (URL/domaine/IP/hash) si possible."
  - step: "Réponse - Collecte preuves"
    when: "decision in ['CONFIRMED','PROBABLE']"
    actions:
      - "Collecter : process tree, CLI, fichiers déposés, connexions réseau, persistance."
      - "Préserver le document Office et les en-têtes email (si disponibles)."
  - step: "Clôture - FP"
    when: "decision == 'FP'"
    actions:
      - "Documenter justification (changement IT / script signé / automatisation approuvée)."
      - "Tuner allowlists si récurrence."

outputs:
  - { name: decision, type: string }
  - { name: notes, type: string }
