# CVE-2026-1731 ‚Äì BeyondTrust Remote Code Execution Detection Pack

üëâüèæ [**French version available here**](README_FR.md)

This repository contains a community-driven Sigma detection pack for CVE-2026-1731 affecting BeyondTrust Remote Support / PRA appliances.

The vulnerability allows pre-authentication remote code execution via improper handling of the `remoteVersion` parameter over the `/nw` WebSocket endpoint.

Reference exploit:
https://github.com/win3zz/CVE-2026-1731

Public research:
- NVD
- Palo Alto Unit42
- BeyondTrust Security Advisory (BT26-02)

---

# üéØ Detection Strategy

The pack follows a structured detection engineering approach:

1. Early reconnaissance detection (BROAD)
2. Exploit confirmation (STRICT)
3. Post-exploitation command execution (BROAD)
4. Persistence / Webshell detection (STRICT)

The objective is to cover the full attack chain:

Recon ‚Üí WebSocket handshake ‚Üí Command injection ‚Üí Shell execution ‚Üí Persistence

---

# üìÇ Included Rules

---

## 1Ô∏è‚É£ WEB - Recon to WebSocket (BROAD)

**File:**  
CVE-2026-1731_BeyondTrust_WEB_Recon_To_WS_BROAD.yml

### What it detects:
- HTTP GET requests to `/get_portal_info`
- HTTP GET requests to `/nw`

### Why it matters:
Attackers typically retrieve organization context using `/get_portal_info`
before establishing a malicious WebSocket connection to `/nw`.

### Purpose:
Early warning / hunting rule.

### MITRE:
- T1190 ‚Äì Exploit Public-Facing Application

---

## 2Ô∏è‚É£ WEB ‚Äì remoteVersion Injection (STRICT)

**File:**  
CVE-2026-1731_BeyondTrust_WEB_remoteVersion_Injection_STRICT.yml

### What it detects:
- Requests targeting `/nw`
- Presence of `remoteVersion`
- Injection patterns such as:
  - `a[$(`
  - `)]0`

These patterns are directly aligned with the public PoC exploit.

### Why it matters:
This is a high-confidence exploitation indicator.

### Purpose:
Exploit confirmation.

### MITRE:
- T1190 ‚Äì Initial Access
- T1059 ‚Äì Command Execution

---

## 3Ô∏è‚É£ LINUX - Suspicious Shell + Tool Execution (BROAD)

**File:**  
CVE-2026-1731_BeyondTrust_LINUX_Suspicious_Shell_Tooling_BROAD.yml

### What it detects:
- Bash or sh execution
- Combined with suspicious tools:
  - curl
  - wget
  - nc
  - python
  - bash -c

### Why it matters:
Successful exploitation leads to command execution on the appliance
under the site user context.

### Purpose:
Detect likely post-exploitation activity.

### MITRE:
- T1059 ‚Äì Command and Scripting Interpreter
- T1105 ‚Äì Ingress Tool Transfer

---

## 4Ô∏è‚É£ LINUX - Webshell PHP Creation (STRICT)

**File:**  
CVE-2026-1731_BeyondTrust_LINUX_Webshell_PHP_Create_STRICT.yml

### What it detects:
- Creation of `.php` files
- Inside web-accessible directories

### Why it matters:
Unit42 observed webshell deployment during exploitation campaigns.

### Purpose:
Persistence detection.

### MITRE:
- T1505.003 - Web Shell

---

# üß† Detection Philosophy

BROAD rules:
- Early indicators
- Higher false positive risk
- Hunting-oriented

STRICT rules:
- Exploit-confirming
- High-confidence
- Suitable for escalation workflows

---

# ‚ö†Ô∏è Tuning Guidance

Before deploying in production:

- Validate log field mapping (nginx, apache, WAF, EDR, etc.)
- Exclude authorized security testing
- Correlate Web + Host telemetry where possible

---

# üìä Maturity Level

| Rule | Status |
|------|--------|
| WEB Recon | experimental |
| WEB Injection | testing |
| LINUX Shell | experimental |
| LINUX Webshell | testing |

---

# üöÄ Recommended SOC Workflow

1. Web STRICT triggers ‚Üí Immediate investigation.
2. Check for appliance shell activity.
3. Search for webshell artifacts.
4. Review outbound connections.
5. Rotate credentials & isolate appliance.

---

Community-driven detection engineering.
Contributions and tuning feedback are welcome.
