# TheHive Task Plan (YAML)
# CVE-2026-20952 - Microsoft Office UAF (STRICT)
# Use as a task blueprint to create tasks in a case template.

tasks:
  - title: "Triage - Validate Alert (L1)"
    group: "Triage"
    order: 10
    description: |
      Validate that the alert matches the STRICT logic:
      - Parent process is Office (WINWORD/EXCEL/POWERPNT/OUTLOOK/MSACCESS)
      - Child process is a command/script engine (PowerShell/cmd/mshta/rundll32/wscript/cscript)
      - Command line contains suspicious patterns (encoded/IEX/DownloadString/javascript/vbscript/.dll,)
    checklist:
      - "Confirm ParentImage (Office) and Child Image (LOLBins)"
      - "Capture full CommandLine and ParentCommandLine"
      - "Identify user and host context (interactive vs automation)"
      - "Check if ParentCommandLine contains /automation /pt /embedding"
    output:
      - "triage_result: FP | Suspicious | Confirmed"

  - title: "Enrichment - Process Tree & Host Context (L2)"
    group: "Investigation"
    order: 20
    description: |
      Build the process tree and collect endpoint context.
    checklist:
      - "Retrieve process tree (parent, grandparent, siblings)"
      - "Collect hashes (Image) if possible"
      - "Check file path (user-writable vs system)"
      - "Identify recent Office documents opened/downloaded (where available)"
    output:
      - "process_tree_collected: yes/no"
      - "suspect_binaries_identified: yes/no"

  - title: "Correlation - Network Egress (L2)"
    group: "Investigation"
    order: 30
    description: |
      Correlate with outbound connections near the alert time.
    checklist:
      - "Check EDR network telemetry or Sysmon EventID 3 (if available)"
      - "Look for HTTP/S to rare or unknown destinations"
      - "Extract destination IP/domain and ports"
      - "Assess reputation via internal TI / allowlists"
    output:
      - "external_egress: yes/no"
      - "destinations: list"

  - title: "Validation - EDR/AV/AMSI Signals (L2)"
    group: "Investigation"
    order: 40
    description: |
      Validate supporting security signals.
    checklist:
      - "Review AMSI detections for PowerShell content (if available)"
      - "Review EDR detections related to LOLBins abuse"
      - "Check Defender/AV alerts around the same time"
    output:
      - "edr_signal_level: none/low/medium/high"

  - title: "Containment - Isolate & Kill Process (L2/L3)"
    group: "Containment"
    order: 50
    description: |
      If exploitation is suspected/confirmed, contain immediately.
    checklist:
      - "Isolate endpoint via EDR (recommended)"
      - "Terminate malicious child process (if safe)"
      - "Block known malicious destinations at proxy/firewall (if confirmed)"
    output:
      - "contained: yes/no"
    conditions:
      run_if:
        - "triage_result in ['Suspicious','Confirmed']"
        - "external_egress == 'yes' or edr_signal_level in ['medium','high']"

  - title: "Evidence - Preserve Artefacts (L2/L3)"
    group: "Forensics"
    order: 60
    description: |
      Preserve artefacts for IR and scoping.
    checklist:
      - "Export process command line, parent/child metadata"
      - "Collect hashes and file samples (quarantine if possible)"
      - "Collect relevant Office document/email artefacts (if applicable)"
      - "Acquire memory snapshot (if IR policy allows)"
    output:
      - "evidence_collected: yes/no"

  - title: "Remediation - Patch & Harden Office (IT/L3)"
    group: "Remediation"
    order: 70
    description: |
      Apply remediation and prevention actions.
    checklist:
      - "Apply Office security updates for CVE-2026-20952"
      - "Enable/validate ASR rules (Office child process blocking where feasible)"
      - "Review macro policy and add-in controls"
      - "Credential reset if compromise suspected"
    output:
      - "patched: yes/no"
      - "hardening_done: yes/no"

  - title: "Hunting - Environment-Wide Search (CTI/SOC)"
    group: "Hunting"
    order: 80
    description: |
      Hunt for similar patterns across the environment (24-72h window).
    checklist:
      - "Search for Office -> (powershell|cmd|mshta|rundll32|wscript|cscript)"
      - "Search for encoded PowerShell and script protocol usage"
      - "Identify clusters by user/host/document/source"
    output:
      - "hunting_results: summary"

  - title: "Closure - Report & Lessons Learned"
    group: "Closure"
    order: 90
    description: |
      Close the case with clear documentation and improvements.
    checklist:
      - "Document timeline, scope, and actions"
      - "Record IOCs (if any) and ATT&CK mapping"
      - "Create tuning tickets (allowlists) if false positive"
      - "Update internal KB / detection catalog"
    output:
      - "closure_notes: completed"
