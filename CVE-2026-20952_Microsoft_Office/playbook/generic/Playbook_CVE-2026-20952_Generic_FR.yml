# Playbook de Réponse à Incident Générique (YAML)
# CVE-2026-20952 – Microsoft Office – Use-After-Free
# Détection associée : Microsoft Office Suspicious Child Process Execution (STRICT)
#
# Objectif :
# - Fournir un playbook générique, indépendant du SIEM/SOAR.
# - Déclenché par une alerte indiquant qu’Office lance un processus enfant suspect.
#
# Références :
# - MSRC : https://msrc.microsoft.com/update-guide/vulnerability/CVE-2026-20952
# - NVD  : https://nvd.nist.gov/vuln/detail/CVE-2026-20952

playbook:
  nom: "CVE-2026-20952 – Microsoft Office UAF (STRICT)"
  id: "playbook-cve-2026-20952-generique-fr-v1"
  version: "1.0.0"
  statut: "stable"
  date_creation: "2026-01-15"
  proprietaire: "SOC"
  severite_par_defaut: "elevee"
  confiance_par_defaut: "elevee"

  declencheur:
    type: "detection"
    source: "SIEM"
    nom_regle: "Microsoft Office Suspicious Child Process Execution (STRICT)"
    exigences_logs:
      - "Création de processus (Sysmon EventID 1 ou équivalent EDR)"
    champs_requis:
      - "ParentImage"
      - "Image"
      - "CommandLine"
      - "Utilisateur"
      - "NomHote"
      - "Horodatage"

  objectifs:
    - "Valider s’il s’agit d’une exploitation réelle ou d’une automatisation légitime."
    - "Confinement rapide pour limiter l’impact."
    - "Collecter les artefacts pour l’analyse et la forensic."
    - "Appliquer les correctifs et durcir la configuration Office."

  roles:
    l1:
      responsabilites:
        - "Triage initial et validation rapide"
        - "Collecte du contexte de base"
        - "Escalade selon la table de décision"
    l2:
      responsabilites:
        - "Investigation approfondie et corrélation"
        - "Actions de confinement"
        - "Coordination avec l’équipe IT"
    l3_ir:
      responsabilites:
        - "Analyse forensic et évaluation du périmètre"
        - "Éradication et restauration"
        - "Retour d’expérience et amélioration continue"

  workflow:
    - phase: "Triage (L1)"
      etapes:
        - id: "T1"
          action: "Validation du lien parent/enfant"
          verifications:
            - "ParentImage se termine par : WINWORD.EXE / EXCEL.EXE / POWERPNT.EXE / OUTLOOK.EXE / MSACCESS.EXE"
            - "Processus enfant = powershell.exe, pwsh.exe, cmd.exe, mshta.exe, rundll32.exe, wscript.exe, cscript.exe"
        - id: "T2"
          action: "Analyse de la ligne de commande"
          verifications:
            - "Présence de : -enc / EncodedCommand / FromBase64String / IEX / Invoke-Expression"
            - "Présence de : DownloadString / http(s):// / javascript: / vbscript: / .dll,"
        - id: "T3"
          action: "Filtrage rapide des faux positifs"
          verifications:
            - "ParentCommandLine contient : /automation OU /pt OU /embedding"
      criteres_sortie:
        - "Si faux positif confirmé → clôturer"
        - "Sinon → escalade L2"

    - phase: "Investigation (L2)"
      etapes:
        - id: "I1"
          action: "Collecte du contexte hôte"
          taches:
            - "Analyse de l’arbre des processus"
            - "Vérification de l’utilisateur connecté"
            - "Identification des documents Office récents"
        - id: "I2"
          action: "Corrélation réseau"
          verifications:
            - "Connexions sortantes HTTP/S inhabituelles"
            - "Correspondance temporelle avec l’exécution Office"
        - id: "I3"
          action: "Analyse des signaux EDR / AMSI"
          verifications:
            - "Alertes AMSI liées à PowerShell"
            - "Détections EDR de LOLBins"

    - phase: "Confinement (L2/L3)"
      etapes:
        - id: "C1"
          action: "Isolation du poste"
        - id: "C2"
          action: "Arrêt du processus malveillant"
        - id: "C3"
          action: "Préservation des preuves"

    - phase: "Éradication & Restauration"
      etapes:
        - id: "E1"
          action: "Application des correctifs Office (CVE-2026-20952)"
        - id: "E2"
          action: "Durcissement Office (ASR, restrictions d’exécution)"
        - id: "E3"
          action: "Surveillance renforcée post-incident"

    - phase: "Post-Incident"
      etapes:
        - id: "P1"
          action: "Ajustement des règles de détection"
        - id: "P2"
          action: "Threat hunting ciblé"
        - id: "P3"
          action: "Documentation et retour d’expérience"

  logique_decisionnelle:
    - si: "arguments_suspects == true et trafic_externe == true"
      alors: "Incident confirmé – confinement immédiat"
    - si: "arguments_suspects == true"
      alors: "Activité suspecte – investigation approfondie"
    - sinon: "Faux positif ou bruit – clôture"
