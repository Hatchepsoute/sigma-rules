# Playbook SOC - Réponse à une exploitation SharePoint RCE (CVE-2026-20947)

## Objectif
Fournir un playbook SOC **générique** pour détecter, analyser et répondre à une exploitation potentielle de **Microsoft SharePoint Server** liée à la vulnérabilité **CVE-2026-20947 (RCE)**.

Ce playbook est volontairement **agnostique SIEM/SOAR** et peut être adapté à TheHive, Cortex, XSOAR, Sentinel, etc.

---

## 1. Déclencheurs (Triggers)

Le playbook est déclenché lorsqu’un ou plusieurs des signaux suivants sont détectés :

### Détection Web (Early Warning)
- Règle Sigma HTTP SharePoint (hunting)
- Requêtes HTTP suspectes vers :
  - /_layouts/15/
  - /_vti_bin/
  - /_api/
- Présence de patterns SQLi / RCE (UNION, WAITFOR, cmd=, powershell)

### Détection Windows (Haute confiance)
- Règle Sigma process_creation
- Parent : w3wp.exe ou OWSTIMER.EXE
- Enfant : cmd.exe / powershell.exe
- Indicateurs forts : EncodedCommand, IEX, DownloadString

---

## 2. Triage initial (SOC L1 / L2)

### Actions immédiates
- Identifier le serveur SharePoint concerné
- Vérifier l’heure exacte de l’événement
- Corréler avec :
  - logs IIS
  - logs Windows (process creation)
  - alertes EDR

### Questions clés
- Le serveur est-il exposé à Internet ?
- La version SharePoint est-elle patchée ?
- L’activité correspond-elle à une fenêtre de maintenance ?

---

## 3. Analyse approfondie (SOC L2 / L3)

### Analyse Windows
- Examiner la ligne de commande complète
- Identifier :
  - téléchargement de payload
  - exécution encodée
  - création de fichiers suspects
- Vérifier la persistance :
  - tâches planifiées
  - services
  - webshells dans wwwroot

### Analyse Web
- Identifier l’IP source
- Rechercher des tentatives répétées
- Vérifier d’autres endpoints SharePoint ciblés

---

## 4. Confinement (Containment)

Si l’exploitation est confirmée ou fortement suspectée :

- Isoler le serveur du réseau (EDR / Firewall)
- Bloquer l’IP source (FW / WAF)
- Suspendre les comptes compromis
- Désactiver temporairement l’accès externe SharePoint si possible

---

## 5. Éradication

- Supprimer :
  - webshells
  - scripts malveillants
  - comptes ajoutés
- Appliquer les correctifs Microsoft (CU SharePoint)
- Réinitialiser les secrets :
  - comptes de service
  - comptes administrateurs

---

## 6. Rétablissement (Recovery)

- Restaurer depuis une sauvegarde saine si nécessaire
- Réactiver les services SharePoint
- Surveiller étroitement pendant 72h :
  - processus
  - trafic sortant
  - logs IIS

---

## 7. Leçons apprises & amélioration

- Ajouter les IoC observés dans le SIEM / EDR
- Améliorer les règles Sigma (filters / corrélations)
- Documenter l’incident (RETEX)
- Vérifier la conformité patch management

---

## Sévérité recommandée
- Détection HTTP seule : Élevée
- Détection process (STRICT) : Critique

---

## Références
- https://nvd.nist.gov/vuln/detail/CVE-2026-20947
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2026-20947
