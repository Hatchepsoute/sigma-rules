# SOC Playbook - SharePoint RCE Exploitation Response (CVE-2026-20947)

## Purpose
Provide a **generic SOC playbook** to detect, investigate, and respond to a potential **Microsoft SharePoint Server RCE** related to **CVE-2026-20947**.

This playbook is **SIEM/SOAR agnostic** and can be adapted to TheHive, Cortex, XSOAR, Sentinel, etc.

---

## 1. Triggers

The playbook is triggered when one or more of the following signals occur:

### Web Detection (Early Warning)
- SharePoint HTTP Sigma rule (hunting)
- Suspicious HTTP requests to:
  - /_layouts/15/
  - /_vti_bin/
  - /_api/
- SQLi / RCE patterns (UNION, WAITFOR, cmd=, powershell)

### Windows Detection (High Confidence)
- process_creation Sigma rule
- Parent: w3wp.exe or OWSTIMER.EXE
- Child: cmd.exe / powershell.exe
- Strong indicators: EncodedCommand, IEX, DownloadString

---

## 2. Initial Triage (SOC L1 / L2)

### Immediate actions
- Identify the affected SharePoint server
- Confirm the exact timestamp
- Correlate with:
  - IIS logs
  - Windows process creation logs
  - EDR alerts

### Key questions
- Is the server Internet-facing?
- Is SharePoint fully patched?
- Is the activity related to maintenance?

---

## 3. Deep Analysis (SOC L2 / L3)

### Windows analysis
- Review full command line
- Look for:
  - payload download
  - encoded execution
  - suspicious file creation
- Check persistence:
  - scheduled tasks
  - services
  - webshells in wwwroot

### Web analysis
- Identify source IP
- Look for repeated exploitation attempts
- Check for additional SharePoint endpoints targeted

---

## 4. Containment

If exploitation is confirmed or strongly suspected:

- Isolate the server (EDR / Firewall)
- Block the source IP (FW / WAF)
- Disable or reset compromised accounts
- Temporarily restrict external SharePoint access if possible

---

## 5. Eradication

- Remove:
  - webshells
  - malicious scripts
  - unauthorized accounts
- Apply Microsoft patches (SharePoint CU)
- Reset secrets:
  - service accounts
  - administrator accounts

---

## 6. Recovery

- Restore from clean backup if required
- Re-enable SharePoint services
- Closely monitor for 72 hours:
  - process activity
  - outbound traffic
  - IIS logs

---

## 7. Lessons Learned & Improvement

- Feed observed IoCs back into SIEM / EDR
- Improve Sigma rules (filters / correlation)
- Document the incident (post-mortem)
- Review patch management process

---

## Recommended Severity
- HTTP detection only: High
- Process detection (STRICT): Critical

---

## References
- https://nvd.nist.gov/vuln/detail/CVE-2026-20947
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2026-20947
