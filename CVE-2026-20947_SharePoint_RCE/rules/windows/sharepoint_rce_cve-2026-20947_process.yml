title: SharePoint IIS Worker Spawning Suspicious Shell With Strong Indicators - CVE-2026-20947
id: b2c3d4e5-6789-01ab-cdef-2345678901bc
status: experimental
description: >
  Detects likely SharePoint exploitation impact where IIS worker (w3wp.exe) spawns a command interpreter with strong suspicious indicators
  (encoded commands, download cradles, or LOLBins). Related to CVE-2026-20947.

  FR=> Détecte l'impact probable d'une exploitation SharePoint où le processus worker IIS (w3wp.exe) génère un interpréteur de commandes présentant
  des indicateurs suspects forts (commandes encodées, scripts de téléchargement ou LOLBins). Lié à la CVE-2026-20947.
author: Adama ASSIONGBON SOC/CTI Consultant | https://www.linkedin.com/in/adama-assiongbon-9029893a
date: 2026-01-29
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2026-20947
  - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2026-20947
  - https://www.cisa.gov/news-events/bulletins/sb26-020
tags:
  - attack.initial-access
  - attack.t1190
  - attack.execution
  - attack.t1059.003
  - attack.defense-evasion
  - attack.t1027
  - attack.persistence
  - attack.t1505.003
  - cve.2026-20947

logsource:
  product: windows
  category: process_creation

detection:
  selection_parent:
    ParentImage|endswith:
      - '\w3wp.exe'
      - '\OWSTIMER.EXE'
      - '\MSOWSE.EXE'

  selection_child_shell:
    Image|endswith:
      - '\cmd.exe'
      - '\powershell.exe'
      - '\pwsh.exe'
      - '\bash.exe'
      - '\sh.exe'

  selection_strong_indicators:
    CommandLine|contains:
      # Encoded commands
      - ' -enc '
      - ' -EncodedCommand '
      - ' -e '
      - 'FromBase64String'
      # PowerShell suspicious patterns
      - 'IEX'
      - 'Invoke-Expression'
      - 'DownloadString'
      - 'Invoke-WebRequest'
      - 'Invoke-RestMethod'
      - 'Net.WebClient'
      - 'System.Net.WebClient'
      # Download cradles
      - 'bitsadmin '
      - 'certutil -urlcache'
      - 'curl '
      - 'wget '
      # LOLBins/script interpreters
      - 'mshta '
      - 'rundll32 '
      - 'regsvr32 '
      - 'wscript '
      - 'cscript '
      - 'msxsl '
      # Suspicious arguments
      - ' /c '
      - ' /k '
      - ' -c '
      - ' -Command '

  filter_known_admin_maintenance:
    CommandLine|contains:
      # SharePoint administration commands (tune per environment)
      - 'Update-SPSolution'
      - 'Install-SPSolution'
      - 'Add-SPSolution'
      - 'Upgrade-SPFarm'
      - 'Get-SPWebApplication'
      - 'Backup-SPFarm'
      - 'Restore-SPFarm'
      - 'Mount-SPContentDatabase'
      - 'Dismount-SPContentDatabase'
    # Service accounts only (keep narrow to avoid false negatives)
    User|contains:
      - 'svc_'

  condition: selection_parent and selection_child_shell and selection_strong_indicators and not filter_known_admin_maintenance

fields:
  - CommandLine
  - ParentCommandLine
  - Image
  - ParentImage
  - User
  - LogonId
  - ProcessId
  - ParentProcessId
  - ComputerName
  - UtcTime

falsepositives:
  - Legitimate SharePoint administrative tasks executing PowerShell from w3wp/OWSTIMER contexts (rare but possible)
  - Authorized deployment automation (solutions/packages) during maintenance windows
  - Security testing with proper authorization

level: critical

