![Sigma](https://img.shields.io/badge/Sigma-Rules-blue)
![Windows](https://img.shields.io/badge/Platform-Windows-informational)
![CVE](https://img.shields.io/badge/CVE-2025--6218-critical)
![License](https://img.shields.io/badge/License-MIT-green)
![SOC](https://img.shields.io/badge/Use--case-SOC%20%7C%20CTI-blueviolet)

This document is bilingual (French and English).  
The French version appears first, followed by the English version.

---
 ğŸ‡«ğŸ‡· Version FranÃ§aise
# ğŸš¨ CVE-2025-50165 - Sigma Detection Pack (Blue Team)
### Client-Side Exploitation via Malicious JPEG Images (Windows Graphics)

## ğŸ¯ Objectif du pack

Ce pack fournit un **ensemble cohÃ©rent de dÃ©tection et de rÃ©ponse SOC** pour la vulnÃ©rabilitÃ© critique **CVE-2025-50165 (CVSS 9.8)** affectant le **Windows Graphics Component** (`windowscodecs.dll`).

Il inclut :
- âœ… **2 rÃ¨gles Sigma complÃ©mentaires** (BROAD+ et STRICT),
- ğŸ§  un **scÃ©nario dâ€™attaque rÃ©aliste** basÃ© sur des documents piÃ©gÃ©s,
- ğŸ”€ un **playbook SOAR** pour la rÃ©ponse automatisÃ©e,
- ğŸ–¼ï¸ un **diagramme dâ€™attaque** illustrant la chaÃ®ne complÃ¨te dâ€™exploitation.

Lâ€™objectif est de dÃ©tecter **lâ€™exploitation rÃ©elle cÃ´tÃ© client**, et non de simples fichiers suspects.

---

## ğŸ“Œ PrÃ©sentation de la vulnÃ©rabilitÃ©

| Ã‰lÃ©ment | DÃ©tail |
|------|------|
| CVE | **CVE-2025-50165** |
| CVSS | **9.8 (Critique)** |
| Composant | Windows Graphics (`windowscodecs.dll`) |
| Vecteur | Image JPEG malveillante |
| Contexte | Documents Office / PDF / Preview |
| Impact | ExÃ©cution de code Ã  distance (RCE) |

Un attaquant peut intÃ©grer une **image JPEG spÃ©cialement forgÃ©e** dans un document Office ou PDF.  
Lors de lâ€™ouverture, le moteur graphique Windows traite lâ€™image et dÃ©clenche lâ€™exploitation.

---

## ğŸ­ ScÃ©nario dâ€™attaque (rÃ©aliste)

### ğŸ“¨ 1ï¸âƒ£ Livraison
Lâ€™attaquant envoie un document piÃ©gÃ© via :
-â™¦ï¸spearphishing email,
-â™¦ï¸ piÃ¨ce jointe PDF ou Office,
-â™¦ï¸document partagÃ© (OneDrive, SharePoint, etc.).

Le document contient une **image JPEG malveillante**.

### ğŸ–¼ï¸ 2ï¸âƒ£ Exploitation cÃ´tÃ© client
Lors de lâ€™ouverture :
- â™¦ï¸lâ€™application (Word, Outlook, lecteur PDF, Photosâ€¦) rend lâ€™image,
- â™¦ï¸windowscodecs.dll` est invoquÃ©e,
- â™¦ï¸la charge malveillante est dÃ©clenchÃ©e **sans interaction supplÃ©mentaire**.

### âš™ï¸ 3ï¸âƒ£ ExÃ©cution de commandes
Le contexte de rendu (Office / PDF / Preview) lance ensuite :
- â™¦ï¸PowerShell,
- â™¦ï¸ `mshta`, `rundll32`, `regsvr32`,
- â™¦ï¸ ou dâ€™autres **LOLbins Windows**,

souvent avec :
-â™¦ï¸ commandes encodÃ©es,
-â™¦ï¸ scripts distants,
-â™¦ï¸ payloads en mÃ©moire.

### ğŸ”¥ 4ï¸âƒ£ Post-exploitation
Lâ€™attaquant peut alors :
- â™¦ï¸ installer un malware,
- â™¦ï¸ Ã©tablir un C2,
- â™¦ï¸ se dÃ©placer latÃ©ralement,
- â™¦ï¸ exfiltrer des donnÃ©es.

---
## ğŸ§  RÃ´le des rÃ¨gles Sigma
### ğŸŸ§ RÃ¨gle 1 - BROAD+
ğŸ“„ `cve-2025-50165_BROAD_renderer_spawns_lolbin.yml`

#### ğŸ¯ RÃ´le
DÃ©tecter **prÃ©cocement** une exploitation cÃ´tÃ© client **suspecte**, avec une bonne couverture.

#### ğŸ” Logique
- Un **contexte de rendu** (Office, PDF, Photos, Explorerâ€¦)  
- lance un **processus non graphique** (PowerShell, cmd, mshta, etc.)  
- avec une **ligne de commande suspecte** (encodage, IEX, URL, DLL).

ğŸ‘‰ğŸ¿ RÃ¨gle idÃ©ale pour :
- threat hunting,
- dÃ©tection large,
- environnements peu bruitÃ©s.

### ğŸŸ¥ RÃ¨gle 2 - STRICT
ğŸ“„ `cve-2025-50165_STRICT_renderer_spawns_lolbin_with_malicious_cli.yml`

#### ğŸ¯ RÃ´le
DÃ©tecter une **exploitation fortement probable**, avec **faible taux de faux positifs**.

#### ğŸ” Logique
- Contexte de rendu document/image,
- lancement dâ€™un **LOLbin spÃ©cifique**,
- **ligne de commande clairement malveillante** (PowerShell encodÃ©, mshta URL, rundll32 DLL, etc.).

ğŸ‘‰ğŸ¿ RÃ¨gle adaptÃ©e Ã  :
- production SOC,
- alertes haute sÃ©vÃ©ritÃ©,
- dÃ©clenchement SOAR.
---

## ğŸ”— Fonctionnement conjoint (corrÃ©lation)

| Situation | InterprÃ©tation SOC |
|--------|-------------------|
| BROAD seule | ActivitÃ© suspecte / tentative |
| STRICT seule | Exploitation trÃ¨s probable |
| **BROAD + STRICT** | ğŸš¨ **Exploitation confirmÃ©e** |

La corrÃ©lation peut Ãªtre implÃ©mentÃ©e :
- dans le **SIEM**,
- ou dans un **SOAR** (TheHive, Shuffle, XSOAR).

---

## ğŸ”€ Playbook & diagramme

Le pack inclut Ã©galement :
- ğŸ”€ un **playbook SOAR** (investigation, confinement, remÃ©diation),
- ğŸ–¼ï¸ un **diagramme dâ€™attaque** montrant :
  - le vecteur image,
  - lâ€™exploitation,
  - lâ€™exÃ©cution de LOLbins,
  - la rÃ©ponse SOC.

---

## ğŸ§¬ MITRE ATT&CK
- **T1203** â€“ Exploitation for Client Execution
- **T1059** â€“ Command and Scripting Interpreter
- **T1218** â€“ Signed Binary Proxy Execution
- **T1071** â€“ Application Layer Protocol (C2)


âš ï¸ Avertissement
Ces rÃ¨gles sont fournies **Ã  des fins exclusivement dÃ©fensives**.  Toujours tester et adapter les rÃ¨gles avant tout dÃ©ploiement en production.

---

ğŸ‡¬ğŸ‡§ English version

## ğŸ¯ Pack Objective

This pack provides a **cohesive SOC detection and response set** for the critical vulnerability **CVE-2025-50165 (CVSS 9.8)** affecting the **Windows Graphics Component** (`windowscodecs.dll`).

It includes:
- âœ… **2 complementary Sigma rules** (BROAD+ and STRICT),
- ğŸ§  a **realistic attack scenario** based on weaponized documents,
- ğŸ”€ a **SOAR playbook** for automated response,
- ğŸ–¼ï¸ an **attack diagram** illustrating the full exploitation chain.

The goal is to detect **real client-side exploitation**, not merely suspicious files.

---

## ğŸ“Œ Vulnerability Overview

| Item | Details |
|------|---------|
| CVE | **CVE-2025-50165** |
| CVSS | **9.8 (Critical)** |
| Component | Windows Graphics (`windowscodecs.dll`) |
| Vector | Malicious JPEG image |
| Context | Office / PDF / Preview |
| Impact | Remote Code Execution (RCE) |

An attacker can embed a **specially crafted JPEG image** into an Office or PDF document.  
When the document is opened, the Windows graphics engine processes the image and triggers exploitation.

---

## ğŸ­ Attack Scenario (Realistic)

### ğŸ“¨ 1ï¸âƒ£ Delivery
The attacker sends a weaponized document via:
- â™¦ï¸ spearphishing email,
- â™¦ï¸PDF or Office attachment,
- â™¦ï¸ shared document (OneDrive, SharePoint, etc.).

The document contains a **malicious JPEG image**.

### ğŸ–¼ï¸ 2ï¸âƒ£ Client-Side Exploitation
Upon opening:
- â™¦ï¸ the application (Word, Outlook, PDF reader, Photos, etc.) renders the image,
- â™¦ï¸ `windowscodecs.dll` is invoked,
- â™¦ï¸ the malicious payload is triggered **without additional user interaction**.

### âš™ï¸ 3ï¸âƒ£ Command Execution
The rendering context (Office / PDF / Preview) then spawns:
- â™¦ï¸ PowerShell,
- â™¦ï¸ `mshta`, `rundll32`, `regsvr32`,
- â™¦ï¸ or other **Windows LOLbins**,

often using:
- â™¦ï¸ encoded commands,
- â™¦ï¸ remote scripts,
- â™¦ï¸ in-memory payloads.

### ğŸ”¥ 4ï¸âƒ£ Post-Exploitation
The attacker can then:
- â™¦ï¸ install malware,
- â™¦ï¸ establish C2 communication,
- â™¦ï¸ move laterally,
- â™¦ï¸ exfiltrate data.

---

## ğŸ§  Role of the Sigma Rules

### ğŸŸ§ Rule 1 â€“ BROAD+
ğŸ“„ `cve-2025-50165_BROAD_renderer_spawns_lolbin.yml`

#### ğŸ¯ Purpose
Detect **early-stage suspicious client-side exploitation** with broad coverage.

#### ğŸ” Logic
- A **rendering context** (Office, PDF, Photos, Explorer, etc.)
- spawns a **non-graphical process** (PowerShell, cmd, mshta, etc.)
- with a **suspicious command line** (encoding, IEX, URL, DLL).

ğŸ‘‰ğŸ¿ Ideal for:
- threat hunting,
- broad detection,
- low-noise environments.

---

### ğŸŸ¥ Rule 2 â€“ STRICT
ğŸ“„ `cve-2025-50165_STRICT_renderer_spawns_lolbin_with_malicious_cli.yml`

#### ğŸ¯ Purpose
Detect **highly probable exploitation** with a **low false-positive rate**.

#### ğŸ” Logic
- Document/image rendering context,
- spawning of a **specific LOLbin**,
- **clearly malicious command line** (encoded PowerShell, mshta URL, rundll32 DLL, etc.).

ğŸ‘‰ğŸ¿ Suitable for:
- SOC production,
- high-severity alerts,
- SOAR triggering.

---

## ğŸ”— Combined Operation (Correlation)

| Situation | SOC Interpretation |
|-----------|--------------------|
| BROAD only | Suspicious activity / attempt |
| STRICT only | Highly probable exploitation |
| **BROAD + STRICT** | ğŸš¨ **Confirmed exploitation** |

Correlation can be implemented:
- within the **SIEM**,
- or via a **SOAR** platform (TheHive, Shuffle, XSOAR).

---

## ğŸ”€ Playbook & Diagram

The pack also includes:
- ğŸ”€ a **SOAR playbook** (investigation, containment, remediation),
- ğŸ–¼ï¸ an **attack diagram** illustrating:
  - the image-based vector,
  - exploitation,
  - LOLbin execution,
  - SOC response.
---
## ğŸ” Sigma to SIEM Conversion

### Recommended Tool
```bash
pip install sigma-cli
```

### Examples
```bash
sigma convert -t splunk rule.yml
sigma convert -t elasticsearch rule.yml
sigma convert -t sentinel rule.yml
```
---

## ğŸ§¬ MITRE ATT&CK
- **T1203** â€“ Exploitation for Client Execution
- **T1059** â€“ Command and Scripting Interpreter
- **T1218** â€“ Signed Binary Proxy Execution
- **T1071** â€“ Application Layer Protocol (C2)

---

âš ï¸ Disclaimer
These rules are provided **for defensive purposes only**.  Always test and adapt the rules before deploying them in production.

 **Author:** Adama Assiongbon  
SOC / CTI Analyst Consultant  
LinkedIn: https://www.linkedin.com/in/adama-assiongbon-9029893a/
